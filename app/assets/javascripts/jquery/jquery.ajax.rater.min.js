/**
 * jQuery Ajax Rater Plugin
 *
 * This rater is based on the code Ritesh Agrawal did. Unfortunatly his CSS and the hover technique breaks in some browsers.
 * So i thought, why not use the best CSS star-rater known to man kind and throw it in the mix.
 * I have used the CSS and technique from Komodo Media since it is stable and tested on many, many browsers.
 *
 * This rater compared, has no cancel button. But i think we can live with that :)
 * To avoid conflicts i have changed the function name.
 *
 * Licensed under The MIT License
 *
 * @version     1.0
 * @since       03.01.2007
 * @author      Kjell Bublitz <m3nt0r.de@gmail.com
 * @link        http://www.m3nt0r.de/devel/raterDemo/ Demonstration and Documentation
 * @link        http://php.scripts.psu.edu/rja171/widgets/rating.php Based on Ritesh Agrawal Star Rating System
 * @link        http://komodomedia.com/blog/index.php/2007/01/20/css-star-rating-redux/ The Komodo Media CSS Rater Blogpost
 * @license     http://www.opensource.org/licenses/mit-license.php MIT
 * @package     jQuery Plugins
 * @subpackage  Rater
 */
/**
 * Usage: $('#rating').rater('your_servlet', {style:'big', maxvalue:5, curvalue:0});
 *
 * @param url The address you want to post the result to.
 * @param options The style and value attributes
 *
 * Valid options:
 * ---------------------------------------
 *       style:       'big', 'inline' OR 'small'
 *       maxvalue:    the maximum value / number of stars
 *       curvalue:    the initial value / selected stars
 */
var from = $("#from_review").text()
;(function(a){a.fn.rater=function(b,c){function i(a){return Math.floor(100/d.maxvalue*a)}if(b==null)return;var d={url:b,maxvalue:5,curvalue:0,read_only:false,update:"#proj_rating",a_klass:""};if(c){jQuery.extend(d,c)}jQuery.extend(d,{cancel:d.maxvalue>1?true:false});var e=jQuery(this);jQuery.extend(e,{averageRating:d.curvalue,url:d.url});var f="star-rating";if(!d.read_only){f+=" writable"}if(!d.style||d.style==null||d.style=="big"){var g=d.maxvalue*18;var h='<ul class="'+f+'">'}if(d.style=="small"){var g=d.maxvalue*10;var h='<ul class="'+f+' small-star" style="width:'+g+'px">'}if(d.style=="inline"){var g=d.maxvalue*10;var h='<span class="inline-rating"><ul class="'+f+' small-star" style="width:'+g+'px">'}e.append(h);var j,k,l="";var m=i(d.curvalue);for(var n=0;n<=d.maxvalue;n++){if(n==0){l+='<li class="current-rating" style="width:'+m+'%;">'+d.curvalue+"/"+d.maxvalue+"</li>"}else{j=i(n);k=d.maxvalue-n+2;var o="";l+='<li class="star"><a class="'+d.a_klass+'" href="#'+n+'" title="'+o+'" style="width:'+j+"%;z-index:"+k+'">'+n+"</a></li>"}}e.find(".star-rating").append(l);if(!d.read_only){var p=jQuery(e).find(".star-rating").children(".star");p.click(function(){if(d.maxvalue==1){d.curvalue=d.curvalue==0?1:0;jQuery(e).find(".star-rating").children(".current-rating").css({width:d.curvalue*100+"%"});jQuery.post(e.url,{score:d.curvalue});return false}else{d.curvalue=p.index(this)+1;raterValue=jQuery(this).children("a")[0].href.split("#")[1];current_rating=a(this).parent().children("li:first");p=a(this);function b(){current_rating.width(i(raterValue)+"%")}if(c.instantGratification){b()}a.ajax({url:e.url,type:"POST",data:{score:raterValue, "from" : from},beforeSend: function() { $("#clear").hide(); $("#rating_spinner").show(); },success:function(e){b();a(d.update).html(e);if(c.success)c.success()}});return false}return this})}else{a(this).css("position","relative")}if(d.read_only=="true"){a(e).append("<div class='blocker' style='width:50px;height:19px;top:0;left:0;position:absolute;' />")}}})(jQuery);
