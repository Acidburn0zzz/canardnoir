var presentDay = new Date();
var year = presentDay.getFullYear();
var year = year - 3;
var month = presentDay.getMonth();

$(function () {
  new Highcharts.Chart({
    chart: {
    renderTo: "graphModal",
    height: 450,
    width: 700,
    borderWidth: 5,
    borderColor: '#525252'
    },
    colors: ['#ee1f08','#39d63c','#2ba5e1'],
    title: {
      text: "Project Comparison Graph"
    },
    subtitle: {
      <%- if @metric == 'Code' -%>
            text: 'Total lines of project source code, excluding comments and blank lines.'
      <%- else %>
            text: '# of <%= @metric.downcase.pluralize %> who made changes to the project source code each month'
      <%- end %>
    },
    xAxis: {
      dateTimeLabelFormats: {
        month: '20%y'
      },
      labels: {
        step: 1
      },
      tickInterval: 24 * 3600 * 1000 * 365,
      type: 'datetime'
    },
    yAxis: {
      title: {
        <%- if @metric == 'Code' -%>
          text: 'Total Lines of Code'
        <%- else %>
          text: '<%= @metric.pluralize %>'
        <% end %>
      },
      <%- if @metric == 'Code' -%>
      tickInterval: 1000000,
      <% end %>
      floor: 0
    },      
    plotOptions: {
        series: {
          pointStart: Date.UTC(year, month, 1),
          pointIntervalUnit: 'month'
      },
      line: {
        marker: {enabled:false},
        shadow : true
      }
    },
    series: [
    <%- @series_of_plot_points.size.times do | index | %>
      <%- project_name = params[:project_data][("project_#{index}").to_sym] %>
    {
      data: <%= @series_of_plot_points[project_name] %>,
      name: '<%= @series_of_plot_points.key(@series_of_plot_points[project_name]) %>'
    },
    <%- end %>
    ]
  });
});

$('#graphModal').modal();