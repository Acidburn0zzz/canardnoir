# OK = greenish
# Warn = orange
# Error = red
# Yes = blue
# No = gray

slave.jobs.incomplete
     .since(get_window)
     .where.not(status: Job::STATUS_FAILED)
     .order(:current_step_at).each_with_index do |job, i|
  status = case job.status
           when Job::STATUS_SCHEDULED then :yes
           when Job::STATUS_RUNNING
             case 
             when job.current_step_at < Time.at(0) - 5.minutes then :ok
             when job.current_step_at < Time.at(0) - 1.hour then :warn
             else :error
             end
           when Job::STATUS_FAILED then :no
           end

  # Add a line break every 3 jobs
  br '' if i != 0 && i % 3 == 0
  a href: admin_job_path(job), style:"text-decoration:none;" do
    status_tag("#{job.class.to_s} (#{job.id})", status, title: job.current_step_at)  
  end
end
