columns do
  column do
    panel "Overview Statistics" do
      table style: "width:300px;" do
        tbody do
          tr do
            td "Scheduled Jobs:"
            td Job.where(status: Job::STATUS_SCHEDULED, slave_id: nil).count
          end              
          tr do
            td "Database Load Average:"
            td style: (LoadAverage.first.too_high? ? "color:red;" : '') do
              LoadAverage.first.current
            end
          end
          tr do
            td "Updated Analyses (#{human_window})"
            td Analysis.where(updated_on: get_window..Time.now).count
          end
        end #tbody
      end #table
    end #panel
  end

  column do
    panel "Deployment Details" do
      begin
        revision_file = File.open("#{Rails.root}/REVISION")
        revision = revision_file.read.strip
        para %(Currently deployed: #{link_to(revision, "https://github.com/blackducksoftware/ohloh-ui/commit/#{revision}")}).html_safe
        para %(Last Deployed: <b>#{time_ago_in_words(revision_file.mtime)}</b> ago).html_safe
        revision_file.close
      rescue Exception => e
        para e
      end
    end
  end
end
